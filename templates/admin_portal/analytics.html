{% extends 'base.html' %}

{% block title %}Analytics - Admin{% endblock %}

{% block content %}
<section style="background: var(--secondary); padding: 2rem 0;">
    <div class="container">
        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
            <a href="{% url 'admin_portal:dashboard' %}" class="btn btn-ghost" style="width: auto; min-width: auto;">‚Üê</a>
            <h1 style="font-size: 2rem; margin: 0;">üìä Platform Analytics</h1>
        </div>
        <p style="color: var(--text-secondary);">Revenue,  performance, and insights</p>
    </div>
</section>

<section class="container" style="padding: 3rem 0;">
    
    <!-- Date Range Filter -->
    <div style="display: flex; gap: 1rem; margin-bottom: 2rem;">
        <a href="?range=7days" class="btn {% if range_filter == '7days' %}btn-primary{% else %}btn-ghost{% endif %}">Last 7 Days</a>
        <a href="?range=30days" class="btn {% if range_filter == '30days' %}btn-primary{% else %}btn-ghost{% endif %}">Last 30 Days</a>
    </div>
    
    <!-- Money Metrics -->
    <div class="grid grid-1 grid-2 mb-4">
        <div class="card card-elevated" style="padding: 2rem; background: hsl(145, 60%, 97%);">
            <h3 style="margin-bottom: 1.5rem;">üí∞ Revenue Breakdown</h3>
            <div style="display: flex; flex-direction: column; gap: 1rem;">
                <div style="display: flex; justify-content: space-between; padding-bottom: 0.75rem; border-bottom: 1px solid var(--border-color);">
                    <span>Total Revenue</span>
                    <span style="font-size: 1.5rem; font-weight: 800; color: var(--primary);">‚Çπ{{ total_revenue|floatformat:2 }}</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding-bottom: 0.75rem; border-bottom: 1px solid var(--border-color);">
                    <span>Platform Commission</span>
                    <span style="font-size: 1.5rem; font-weight: 800; color: var(--primary);">‚Çπ{{ total_commission|floatformat:2 }}</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding-bottom: 0.75rem; border-bottom: 1px solid var(--border-color);">
                    <span>Shop Payouts</span>
                    <span style="font-size: 1.5rem; font-weight: 700; color: var(--text-secondary);">‚Çπ{{ shop_payouts|floatformat:2 }}</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span style="color: hsl(0, 80%, 50%);">Total Refunds</span>
                    <span style="font-size: 1.5rem; font-weight: 700; color: hsl(0, 80%, 50%);">‚Çπ{{ total_refunds|floatformat:2 }}</span>
                </div>
            </div>
        </div>
        
        <div class="card card-elevated" style="padding: 2rem;">
            <h3 style="margin-bottom: 1.5rem;">üì¶ Order Statistics</h3>
            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                {% for order_status in order_counts %}
                <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: var(--bg-light); border-radius: var(--radius-md);">
                    <span>{{ order_status.status }}</span>
                    <span style="font-weight: 700;">{{ order_status.count }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    
    <!-- Top Shops -->
    <div class="card card-elevated">
        <h3 style="margin-bottom: 1.5rem;">üèÜ Top 5 Performing Shops</h3>
        <div class="table-responsive">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="border-bottom: 2px solid var(--border-color);">
                        <th style="padding: 1rem; text-align: left;">Rank</th>
                        <th style="padding: 1rem; text-align: left;">Shop Name</th>
                        <th style="padding: 1rem; text-align: left;">Location</th>
                        <th style="padding: 1rem; text-align: right;">Total Orders</th>
                        <th style="padding: 1rem; text-align: right;">Rating</th>
                    </tr>
                </thead>
                <tbody>
                    {% for shop in top_shops %}
                    <tr style="border-bottom: 1px solid var(--border-color);">
                        <td style="padding: 1rem;">
                            {% if forloop.counter == 1 %}ü•á
                            {% elif forloop.counter == 2 %}ü•à
                            {% elif forloop.counter == 3 %}ü•â
                            {% else %}{{ forloop.counter }}{% endif %}
                        </td>
                        <td style="padding: 1rem;"><strong>{{ shop.name }}</strong></td>
                        <td style="padding: 1rem;">{{ shop.location }}</td>
                        <td style="padding: 1rem; text-align: right; font-weight: 700;">{{ shop.order_count }}</td>
                        <td style="padding: 1rem; text-align: right;">‚≠ê {{ shop.rating }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" style="padding: 2rem; text-align: center; color: var(--text-muted);">
                            No data available
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
</section>
{% endblock %}
